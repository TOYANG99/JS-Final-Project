const express = require('express');
const router = express.Router();
const { getCollection, ObjectId } = require('../../../dbconnect');

let collection = null;

const getEvents = async () => {
    if (!collection) collection = await getCollection('FoodTruckAPI', 'Events');
    return collection;
}


// GET /api/v1/events - Retrieve all events
router.get('/', async (req, res) => {
    
    res.send(await (await getEvents()).find({}).toArray());
    
});


    
// GET /api/v1/events/:id - Retrieve a specific event by ID
router.get('/:id', async (req, res) => {
    const {id} = req.params
    const collection = await getEvents();
    const event = await collection.findOne({_id: new ObjectId(id)});
    if (event) {
        res.send(event);
    } else {
        res.send({ error: { message: 'Event not found' } });
    }
});

// POST /api/v1/events - Create a new event
router.post('/', async (req, res) => {
    const  {name, location, date, time}  = req.body;
    const collection = await getEvents();
    const { acknowledged, insertedId } = await collection.insertOne({name,
        location,
        date,
        time});
    res.send({ acknowledged, insertedId }); 
});

module.exports = router;