const express = require('express');
const router = express.Router();
const { getCollection, ObjectId } = require('../../../dbconnect');

let collection = null;

const getMenu = async () => {
    if (!collection) collection = await getCollection('FoodTruckAPI', 'Menu');
    return collection;
}


// GET /api/v1/menu - Retrieve all menu items
router.get('/', async (req, res) => {
    res.send(await (await getMenu()).find({}).toArray());
});

// GET /api/v1/menu/:id - Retrieve a specific menu item by ID
router.get('/:id', (req, res) => {
    const {id} = req.params;
    const menu = menu.find(item => item.id === parseInt(id));
   if (menu) {
        res.send(menu);
    } else {
        res.send({ error: { message: 'Menu item not found' } });
    }
});

// POST /api/v1/events - Create a new event
router.post('/', async (req, res) => {
    const  {name, description, price, imageUrl}  = req.body;
    const collection = await getMenu();
    const { acknowledged, insertedId } = await collection.insertOne({name,
        description,
        price,
        imageUrl});
    res.send({ acknowledged, insertedId }); 
});

module.exports = router;